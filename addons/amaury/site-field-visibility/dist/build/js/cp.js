Statamic.booting(()=>{var f,g,b;const c="site--",p=i=>{try{Array.from(document.body.classList||[]).forEach(l=>{l.startsWith(c)&&document.body.classList.remove(l)})}catch{}i&&document.body.classList.add(`${c}${i}`)},S=i=>{const e=[`.publish-field__${i}`,`[data-field="${i}"]`,`[name="${i}"]`,`.fieldtype-replicator[data-field="${i}"]`,`.replicator-field[data-field="${i}"]`];let l=0;return e.forEach(o=>{document.querySelectorAll(o).forEach(t=>{t&&t.style&&(t.style.display="none",l++)})}),console.log("[SiteFieldVisibility] HideField",i,"total hidden:",l),l},u=i=>{const e=[`.publish-field__${i}`,`[data-field="${i}"]`,`[name="${i}"]`,`.fieldtype-replicator[data-field="${i}"]`,`.replicator-field[data-field="${i}"]`];console.log("[SiteFieldVisibility] Looking for field:",i);let l=0;return e.forEach(o=>{const s=document.querySelectorAll(o);console.log("[SiteFieldVisibility] Selector:",o,"found",s.length,"nodes"),s.forEach(t=>{if(t){console.log("[SiteFieldVisibility] Before - display:",t.style.display,"visibility:",t.style.visibility,"classList:",t.classList.toString()),t.style.setProperty("display","block","important"),t.style.setProperty("visibility","visible","important"),t.style.setProperty("opacity","1","important"),t.style.setProperty("height","auto","important"),t.style.setProperty("max-height","none","important"),t.classList.remove("hidden","invisible","opacity-0","h-0","max-h-0");let n=t.parentElement,a=0;for(;n&&a<5;)n.style.display==="none"&&(n.style.setProperty("display","block","important"),console.log("[SiteFieldVisibility] Fixed parent display:",n)),n=n.parentElement,a++;console.log("[SiteFieldVisibility] After - display:",t.style.display,"visibility:",t.style.visibility,"classList:",t.classList.toString()),l++}})}),console.log("[SiteFieldVisibility] ShowField",i,"total shown:",l),l},h=i=>{var l,o,s,t;if(console.log("[SiteFieldVisibility] store.state:",i==null?void 0:i.state),console.log("[SiteFieldVisibility] store.getters:",i==null?void 0:i.getters),(l=i==null?void 0:i.state)!=null&&l.site)return console.log("[SiteFieldVisibility] via state.site ->",i.state.site),i.state.site;if((o=i==null?void 0:i.getters)!=null&&o.site)return console.log("[SiteFieldVisibility] via getters.site ->",i.getters.site),i.getters.site;if((t=(s=i==null?void 0:i.state)==null?void 0:s.values)!=null&&t.site)return console.log("[SiteFieldVisibility] via values.site ->",i.state.values.site),i.state.values.site;const e=window.Statamic&&window.Statamic.config&&window.Statamic.config.site&&window.Statamic.config.site.handle?window.Statamic.config.site.handle:"default";return console.log("[SiteFieldVisibility] fallback config ->",e),e},m=async i=>{try{const e=await fetch("/cp/field-visibility/config/"+i);if(e.ok)return await e.json()}catch(e){console.log("[SiteFieldVisibility] Could not fetch config for",i,e)}return{hidden_fields:i==="groupe_blachere"?["marie_blachere_builder"]:[],visible_fields:i==="marie_blachere"?["marie_blachere_builder","page_builder"]:["page_builder"]}},d=async(i,e=0)=>{p(i);let l=0;const o=await m(i);console.log("[SiteFieldVisibility] Config for",i,":",o),o.hidden_fields&&o.hidden_fields.length>0&&o.hidden_fields.forEach(s=>{console.log("[SiteFieldVisibility] Hiding field:",s),l+=S(s)}),o.visible_fields&&o.visible_fields.length>0&&o.visible_fields.forEach(s=>{console.log("[SiteFieldVisibility] Showing field:",s),u(s)}),l===0&&e<3&&document.querySelector(".publish-form")&&(console.log("[SiteFieldVisibility] No fields hidden, retrying in 500ms (attempt",e+1,")"),setTimeout(()=>d(i,e+1),500))},_=({store:i})=>{let e=h(i);if((!e||e==="default")&&window.__ACTIVE_SITE&&typeof window.__ACTIVE_SITE=="string"&&(console.log("[SiteFieldVisibility] using observed __ACTIVE_SITE =",window.__ACTIVE_SITE),e=window.__ACTIVE_SITE),!e||e==="default"){const l=document.querySelector('.publish-form [name="site"], form[action*="/cp/"] [name="site"]');l&&l.value&&(e=l.value,console.log("[SiteFieldVisibility] found hidden form site =",e))}console.log("[SiteFieldVisibility] publish:booted activeSite =",e),d(e)};Statamic.$hooks.on("publish:booted",_);const r=i=>{i&&window.__ACTIVE_SITE!==i&&(window.__ACTIVE_SITE=i,console.log("[SiteFieldVisibility] ObservedSite set to",i),setTimeout(()=>d(i),100))};try{const i=window.fetch;window.fetch=function(e,l){try{const o=typeof e=="string"?e:e==null?void 0:e.url,t=new URL(o,window.location.origin).searchParams.get("site");t&&r(t)}catch{}return i.apply(this,arguments)}}catch(i){console.log("[SiteFieldVisibility] HookFetch error",i)}try{const i=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,l,o,s,t){try{const a=new URL(l,window.location.origin).searchParams.get("site");a&&r(a)}catch{}return i.apply(this,arguments)}}catch(i){console.log("[SiteFieldVisibility] HookXHR error",i)}const y=window.__ACTIVE_SITE||((b=(g=(f=window.Statamic)==null?void 0:f.config)==null?void 0:g.site)==null?void 0:b.handle)||"default";console.log("[SiteFieldVisibility] initial site =",y),d(y)});
